var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){function e(c){var v={single:function(e,r,n){return e?(t(e)||(e=v.getPreparedSearch(e)),r?(t(r)||(r=v.getPrepared(r)),((n&&void 0!==n.allowTypo?n.allowTypo:!c||void 0===c.allowTypo||c.allowTypo)?v.algorithm:v.algorithmNoTypo)(e,r,e[0])):null):null},go:function(e,r,a){if(!e)return f;e=v.prepareSearch(e);var i=e[0],l=a&&a.threshold||c&&c.threshold||-9007199254740991,u=a&&a.limit||c&&c.limit||9007199254740991,s=a&&void 0!==a.allowTypo?a.allowTypo:!c||void 0===c.allowTypo||c.allowTypo,p=s?v.algorithm:v.algorithmNoTypo,g=0,y=0,h=r.length;if(a&&a.keys)for(var w=a.scoreFn||n,x=a.keys,m=x.length,b=h-1;b>=0;--b){for(var T=r[b],k=new Array(m),I=m-1;I>=0;--I){var _=x[I],B=o(T,_);B?(t(B)||(B=v.getPrepared(B)),k[I]=p(e,B,i)):k[I]=null}k.obj=T;var C=w(k);null!==C&&(C<l||(k.score=C,g<u?(d.add(k),++g):(++y,C>d.peek().score&&d.replaceTop(k))))}else if(a&&a.key)for(var _=a.key,b=h-1;b>=0;--b){var T=r[b],B=o(T,_);if(B){t(B)||(B=v.getPrepared(B));var S=p(e,B,i);null!==S&&(S.score<l||(S={target:S.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:S.score,indexes:S.indexes,obj:T},g<u?(d.add(S),++g):(++y,S.score>d.peek().score&&d.replaceTop(S))))}}else for(var b=h-1;b>=0;--b){var B=r[b];if(B){t(B)||(B=v.getPrepared(B));var S=p(e,B,i);null!==S&&(S.score<l||(g<u?(d.add(S),++g):(++y,S.score>d.peek().score&&d.replaceTop(S))))}}if(0===g)return f;for(var A=new Array(g),b=g-1;b>=0;--b)A[b]=d.poll();return A.total=g+y,A},goAsync:function(e,r,i){var l=!1,u=new Promise(function(u,s){function d(){if(l)return s("canceled");var p=Date.now();if(i&&i.keys)for(var c=i.scoreFn||n,m=i.keys,I=m.length;h>=0;--h){for(var _=r[h],B=new Array(I),C=I-1;C>=0;--C){var S=m[C],A=o(_,S);A?(t(A)||(A=v.getPrepared(A)),B[C]=b(e,A,g)):B[C]=null}B.obj=_;var L=c(B);if(null!==L&&(!(L<w)&&(B.score=L,T<x?(y.add(B),++T):(++k,L>y.peek().score&&y.replaceTop(B)),h%1e3==0&&Date.now()-p>=10)))return void(a?setImmediate(d):setTimeout(d))}else if(i&&i.key)for(var S=i.key;h>=0;--h){var _=r[h],A=o(_,S);if(A){t(A)||(A=v.getPrepared(A));var P=b(e,A,g);if(null!==P&&!(P.score<w)&&(P={target:P.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:P.score,indexes:P.indexes,obj:_},T<x?(y.add(P),++T):(++k,P.score>y.peek().score&&y.replaceTop(P)),h%1e3==0&&Date.now()-p>=10))return void(a?setImmediate(d):setTimeout(d))}}else for(;h>=0;--h){var A=r[h];if(A){t(A)||(A=v.getPrepared(A));var P=b(e,A,g);if(null!==P&&!(P.score<w)&&(T<x?(y.add(P),++T):(++k,P.score>y.peek().score&&y.replaceTop(P)),h%1e3==0&&Date.now()-p>=10))return void(a?setImmediate(d):setTimeout(d))}}if(0===T)return u(f);for(var j=new Array(T),N=T-1;N>=0;--N)j[N]=y.poll();j.total=T+k,u(j)}if(!e)return u(f);e=v.prepareSearch(e);var g=e[0],y=p(),h=r.length-1,w=i&&i.threshold||c&&c.threshold||-9007199254740991,x=i&&i.limit||c&&c.limit||9007199254740991,m=i&&void 0!==i.allowTypo?i.allowTypo:!c||void 0===c.allowTypo||c.allowTypo,b=m?v.algorithm:v.algorithmNoTypo,T=0,k=0;a?setImmediate(d):d()});return u.cancel=function(){l=!0},u},highlight:function(e,r,n){if(null===e)return null;void 0===r&&(r="<b>"),void 0===n&&(n="</b>");for(var o="",t=0,a=!1,i=e.target,l=i.length,f=e.indexes,u=0;u<l;++u){var s=i[u];if(f[t]===u){if(++t,a||(a=!0,o+=r),t===f.length){o+=s+n+i.substr(u+1);break}}else a&&(a=!1,o+=n);o+=s}return o},prepare:function(e){if(e)return{target:e,_targetLowerCodes:v.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:v.prepareLowerCodes(e),_nextBeginningIndexes:v.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return v.prepareLowerCodes(e)},getPrepared:function(e){if(e.length>999)return v.prepare(e);var r=i.get(e);return void 0!==r?r:(r=v.prepare(e),i.set(e,r),r)},getPreparedSearch:function(e){if(e.length>999)return v.prepareSearch(e);var r=l.get(e);return void 0!==r?r:(r=v.prepareSearch(e),l.set(e,r),r)},algorithm:function(e,r,n){for(var o=r._targetLowerCodes,t=e.length,a=o.length,i=0,l=0,f=0,p=0;;){var d=n===o[l];if(d){if(u[p++]=l,++i===t)break;n=e[0===f?i:f===i?i+1:f===i-1?i-1:i]}if(++l>=a)for(;;){if(i<=1)return null;if(0===f){--i;var c=e[i];if(n===c)continue;f=i}else{if(1===f)return null;--f,i=f,n=e[i+1];var c=e[i];if(n===c)continue}p=i,l=u[p-1]+1;break}}var i=0,g=0,y=!1,h=0,w=r._nextBeginningIndexes;null===w&&(w=r._nextBeginningIndexes=v.prepareNextBeginningIndexes(r.target));var x=l=0===u[0]?0:w[u[0]-1];if(l!==a)for(;;)if(l>=a){if(i<=0){if(++g>t-2)break;if(e[g]===e[g+1])continue;l=x;continue}--i;var m=s[--h];l=w[m]}else{var d=e[0===g?i:g===i?i+1:g===i-1?i-1:i]===o[l];if(d){if(s[h++]=l,++i===t){y=!0;break}++l}else l=w[l]}if(y)var b=s,T=h;else var b=u,T=p;for(var k=0,I=-1,_=0;_<t;++_){var l=b[_];I!==l-1&&(k-=l),I=l}y?0!==g&&(k+=-20):(k*=1e3,0!==f&&(k+=-20)),k-=a-t,r.score=k,r.indexes=new Array(T);for(var _=T-1;_>=0;--_)r.indexes[_]=b[_];return r},algorithmNoTypo:function(e,r,n){for(var o=r._targetLowerCodes,t=e.length,a=o.length,i=0,l=0,f=0;;){var p=n===o[l];if(p){if(u[f++]=l,++i===t)break;n=e[i]}if(++l>=a)return null}var i=0,d=!1,c=0,g=r._nextBeginningIndexes;null===g&&(g=r._nextBeginningIndexes=v.prepareNextBeginningIndexes(r.target));l=0===u[0]?0:g[u[0]-1];if(l!==a)for(;;)if(l>=a){if(i<=0)break;--i;var y=s[--c];l=g[y]}else{var p=e[i]===o[l];if(p){if(s[c++]=l,++i===t){d=!0;break}++l}else l=g[l]}if(d)var h=s,w=c;else var h=u,w=f;for(var x=0,m=-1,b=0;b<t;++b){var l=h[b];m!==l-1&&(x-=l),m=l}d||(x*=1e3),x-=a-t,r.score=x,r.indexes=new Array(w);for(var b=w-1;b>=0;--b)r.indexes[b]=h[b];return r},prepareLowerCodes:function(e){for(var r=e.length,n=[],o=e.toLowerCase(),t=0;t<r;++t)n[t]=o.charCodeAt(t);return n},prepareBeginningIndexes:function(e){for(var r=e.length,n=[],o=0,t=!1,a=!1,i=0;i<r;++i){var l=e.charCodeAt(i),f=l>=65&&l<=90,u=f||l>=97&&l<=122||l>=48&&l<=57,s=f&&!t||!a||!u;t=f,a=u,s&&(n[o++]=i)}return n},prepareNextBeginningIndexes:function(e){for(var r=e.length,n=v.prepareBeginningIndexes(e),o=[],t=n[0],a=0,i=0;i<r;++i)t>i?o[i]=t:(t=n[++a],o[i]=void 0===t?r:t);return o},cleanup:r,new:e};return v}function r(){i.clear(),l.clear(),u=[],s=[]}function n(e){for(var r=-9007199254740991,n=e.length-1;n>=0;--n){var o=e[n];if(null!==o){var t=o.score;t>r&&(r=t)}}return-9007199254740991===r?null:r}function o(e,r){var n=e[r];if(void 0!==n)return n;var o=r;Array.isArray(r)||(o=r.split("."));for(var t=o.length,a=-1;e&&++a<t;)e=e[o[a]];return e}function t(e){return"object"===(void 0===e?"undefined":_typeof(e))}var a="undefined"!=typeof require&&"undefined"==typeof window,i=new Map,l=new Map,f=[];f.total=0;var u=[],s=[],p=function(){function e(){for(var e=0,o=r[e],t=1;t<n;){var a=t+1;e=t,a<n&&r[a].score<r[t].score&&(e=a),r[e-1>>1]=r[e],t=1+(e<<1)}for(var i=e-1>>1;e>0&&o.score<r[i].score;i=(e=i)-1>>1)r[e]=r[i];r[e]=o}var r=[],n=0,o={};return o.add=function(e){var o=n;r[n++]=e;for(var t=o-1>>1;o>0&&e.score<r[t].score;t=(o=t)-1>>1)r[o]=r[t];r[o]=e},o.poll=function(){if(0!==n){var o=r[0];return r[0]=r[--n],e(),o}},o.peek=function(e){if(0!==n)return r[0]},o.replaceTop=function(n){r[0]=n,e()},o},d=p();return e()});
