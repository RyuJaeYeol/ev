$(function(){var t=$("#cityCode").val(),a=new LocalDB(t),e=$("#stationCode").val(),o=$("#stationName").val(),i=$("#stationDirection").val(),n=$("#stationLink").val();a.getStationIndex(e)>=0&&$("#icon-button-favorite").addClass("active"),$("#icon-button-favorite").click(function(){a.getStationIndex(e)>=0?(a.removeStation(e),$(this).removeClass("active")):(a.addStation(e,o,n,i),$(this).addClass("active"))});var r=$("#refresh"),s=function(t){var a={};for(var e in t)a[t[e].routeid]={arrTime:t[e].arrtime,arrCnt:t[e].arrprevstationcnt};$(".item.routeNo").each(function(){var t=$(this).attr("data-no");a[t]?($(this).is(".arrNot")&&$(this).removeClass("arrNot"),$(this).find(".routeTp").text(Math.round(parseInt(a[t].arrTime)/60)+"분 ("+parseInt(a[t].arrCnt)+"전)")):($(this).is(".arrNot")||$(this).addClass("arrNot"),$(this).find(".routeTp").text("도착 예정 없음"))})},d=function(){if(!c){var t=$("#cityCode").val(),a=$("#stationCode").val();u(),$.ajax({url:"//api.yohan1002.com/requestApi.php?s=bus",method:"GET",data:{cityCode:t,nodeId:a},success:function(t){t.response&&t.response.body&&t.response.body.items&&t.response.body.items.item&&(s(t.response.body.items.item),l())},fail:function(t){l()}})}},c=!1,u=function(){c||(c=!0,$("#routeNumbers").is(".loading")||$("#routeNumbers").addClass("loading"))},l=function(){$("#routeNumbers").is(".loading")&&$("#routeNumbers").removeClass("loading"),c=!1};r.on("click",d),a.addRecentlyStation(e,o,n,i),d()});
