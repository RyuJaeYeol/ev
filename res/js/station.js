$(function(){var t=$("#cityCode").val(),o=new LocalDB(t),a=$("#stationCode").val(),i=$("#stationName").val(),e=$("#stationDirection").val(),n=$("#stationLink").val();o.getStationIndex(a)>=0&&$("#icon-button-favorite").addClass("active"),$("#icon-button-favorite").click(function(){o.getStationIndex(a)>=0?(o.removeStation(a),$(this).removeClass("active")):(o.addStation(a,i,n,e),$(this).addClass("active"))});var r=$("#refresh"),s=function(t){var o={};for(var a in t)o[t[a].routeid]={arrTime:t[a].arrtime,arrCnt:t[a].arrprevstationcnt};$(".item.routeNo").each(function(){var t=$(this).attr("data-no");o[t]?($(this).is(".arrNot")&&$(this).removeClass("arrNot"),$(this).find(".routeTp").text(Math.round(parseInt(o[t].arrTime)/60)+"분 ("+parseInt(o[t].arrCnt)+"전)")):($(this).is(".arrNot")||$(this).addClass("arrNot"),$(this).find(".routeTp").text("도착 예정 없음"))})},d=function(){if(!c){var t=$("#cityCode").val(),o=$("#stationCode").val();u(),$.ajax({url:"//api.yohan1002.com/requestApi.php?s=bus",method:"GET",data:{cityCode:t,nodeId:o},success:function(t){try{s(void 0===t.response||void 0===t.response.body||void 0===t.response.body.items||void 0===t.response.body.items.item?[]:t.response.body.items.item)}catch(t){}v()},fail:function(t){v()}})}},c=!1,u=function(){c||(c=!0,$("#routeNumbers").is(".loading")||$("#routeNumbers").addClass("loading"))},v=function(){$("#routeNumbers").is(".loading")&&$("#routeNumbers").removeClass("loading"),c=!1};r.on("click",d),o.addRecentlyStation(a,i,n,e),d()});
