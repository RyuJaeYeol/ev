$(function(){var t=$("#cityCode").val(),o=new LocalDB(t),i=$("#stationCode").val(),a=$("#stationName").val(),e=$("#stationDirection").val(),r=$("#stationLink").val();o.getStationIndex(i)>=0&&$("#icon-button-favorite").addClass("active"),$("#icon-button-favorite").click(function(){o.getStationIndex(i)>=0?(o.removeStation(i),$(this).removeClass("active")):(o.addStation(i,a,r,e),$(this).addClass("active"))});var n=$("#refresh"),s=function(t){var o={};for(var i in t)o[t[i].routeid]={arrTime:t[i].arrtime,arrCnt:t[i].arrprevstationcnt};$(".item.routeNo").each(function(){var t=$(this).attr("data-no");o[t]?($(this).is(".arrNot")&&$(this).removeClass("arrNot"),$(this).find(".routeTp").text(Math.round(parseInt(o[t].arrTime)/60)+"분 ("+parseInt(o[t].arrCnt)+"전)")):($(this).is(".arrNot")||$(this).addClass("arrNot"),$(this).find(".routeTp").text("도착 예정 없음"))})},d=function(){if(!c){var t=$("#cityCode").val(),o=$("#stationCode").val();u(),$.ajax({url:"//api.yohan1002.com/requestApi.php?s=bus",method:"GET",data:{cityCode:t,nodeId:o},success:function(t){try{if(void 0===t.response||void 0===t.response.body||void 0===t.response.body.items||void 0===t.response.body.items.items)return void s([]);s(t.response.body.items.item)}catch(t){}v()},fail:function(t){v()}})}},c=!1,u=function(){c||(c=!0,$("#routeNumbers").is(".loading")||$("#routeNumbers").addClass("loading"))},v=function(){$("#routeNumbers").is(".loading")&&$("#routeNumbers").removeClass("loading"),c=!1};n.on("click",d),o.addRecentlyStation(i,a,r,e),d()});
