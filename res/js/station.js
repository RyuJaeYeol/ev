$(function(){var a=$("#cityCode").val(),t=new LocalDB(a),o=$("#stationCode").val(),e=$("#stationName").val(),n=$("#stationDirection").val(),i=$("#stationLink").val(),s=$("#stationLat").val(),r=$("#stationLng").val();t.getStationIndex(o)>=0&&$("#icon-button-favorite").addClass("active"),$("#icon-button-favorite").click(function(){t.getStationIndex(o)>=0?(t.removeStation(o),$(this).removeClass("active")):(t.addStation(o,e,i,n),$(this).addClass("active"))});var d=$("#refresh"),l=function(a){var t={};for(var o in a)t[a[o].routeid]={arrTime:a[o].arrtime,arrCnt:a[o].arrprevstationcnt};$(".item.routeNo").each(function(){var a=$(this).attr("data-no");t[a]?($(this).is(".arrNot")&&$(this).removeClass("arrNot"),$(this).find(".routeTp").text(Math.round(parseInt(t[a].arrTime)/60)+"분 ("+parseInt(t[a].arrCnt)+"전)")):($(this).is(".arrNot")||$(this).addClass("arrNot"),$(this).find(".routeTp").text("도착 예정 없음"))})},c=function(){if(!v){var a=$("#cityCode").val(),t=$("#stationCode").val();p(),$.ajax({url:"//api.yohan1002.com/requestApi.php?s=bus",method:"GET",data:{cityCode:a,nodeId:t},success:function(a){try{l(void 0===a.response||void 0===a.response.body||void 0===a.response.body.items||void 0===a.response.body.items.item?[]:a.response.body.items.item)}catch(a){}u()},fail:function(a){u()}})}},v=!1,p=function(){v||(v=!0,$("#routeNumbers").is(".loading")||$("#routeNumbers").addClass("loading"))},u=function(){$("#routeNumbers").is(".loading")&&$("#routeNumbers").removeClass("loading"),v=!1};if($("#btnSearchingLocation").length>=1){var m=null,f=null,h=null,C=function(){m&&m.hide(),$("body").css("overflow","auto")};$("#btnSearchingLocation").click(function(){if(!m){m=$("<div></div>"),m.addClass("layerMapBox"),m.append($('<div class="layerMapBg"></div>')),m.append($('<div class="layerMapContent"></div>'));var a='<div class="header"><span class="ttl"></span> <button type="button" id="layer_map_close">닫기</button></div>';a+='<div class="map"></div>',m.find(".layerMapContent").append($(a)),$("body").append(m),$("#layer_map_close").click(C),m.find(".ttl").html(e)}m.show();var t=new kakao.maps.LatLng(s,r);if(f&&h)f.setCenter(t),h.setPosition(t);else{var o=m.find(".map").get(0),n={center:t,level:3};f=new kakao.maps.Map(o,n),h=new kakao.maps.Marker({position:t}),h.setMap(f);var i=new kakao.maps.MapTypeControl;f.addControl(i,kakao.maps.ControlPosition.TOPRIGHT);var d=new kakao.maps.ZoomControl;f.addControl(d,kakao.maps.ControlPosition.RIGHT)}$("body").css("overflow","hidden")})}d.on("click",c),t.addRecentlyStation(o,e,i,n),c()});
